/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * TextFileSplitterPanel.java
 *
 * Created on Jun 18, 2009, 2:31:08 PM
 */

package com.jnp.ui;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.text.DecimalFormat;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JFileChooser;
import javax.swing.JTextArea;

/**
 *
 * @author Green Moon
 */
public class TextFileSplitterPanel extends javax.swing.JPanel {

    private Long lineStartFrom = 0L;
    private Long lineEndTo = 0L;
    private JTextArea textArea;
    private Long totalCount = 0L;
    private File selectedFile;

    public static final int OK_OPTION = 1110;
    public static final int CANCEL_OPTION = 1111;
    private int selectedOption = CANCEL_OPTION;
    public static final Long KB = 1024L;
    public static final Long MB = KB * 1024L;
    public static final Long GB = MB * 1024L;


    /** Creates new form TextFileSplitterPanel */
    public TextFileSplitterPanel() {
        initComponents();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        buttonGroup1 = new javax.swing.ButtonGroup();
        jLabel1 = new javax.swing.JLabel();
        inputFileTextField = new javax.swing.JTextField();
        inputFileButton = new javax.swing.JButton();
        jLabel2 = new javax.swing.JLabel();
        fileSizeTextField = new javax.swing.JTextField();
        jSeparator1 = new javax.swing.JSeparator();
        opLabel = new javax.swing.JLabel();
        outputDirTextField = new javax.swing.JTextField();
        browseOPDirButton = new javax.swing.JButton();
        fileSizeLabel = new javax.swing.JLabel();
        noOfPartsRadioButton = new javax.swing.JRadioButton();
        maxSizePartRadioButton = new javax.swing.JRadioButton();
        noOfLinesRadioButton = new javax.swing.JRadioButton();
        noOfPartsTextField = new javax.swing.JTextField();
        maxSizePartTextField = new javax.swing.JTextField();
        noOfLinesTextField = new javax.swing.JTextField();
        jLabel5 = new javax.swing.JLabel();
        totalLinesTextField = new javax.swing.JTextField();

        jLabel1.setText("Input File");

        inputFileTextField.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                inputFileTextFieldActionPerformed(evt);
            }
        });

        inputFileButton.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icons/folder_open_file.png"))); // NOI18N
        inputFileButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                inputFileButtonActionPerformed(evt);
            }
        });

        jLabel2.setText("Size");

        fileSizeTextField.setFont(new java.awt.Font("Verdana", 1, 12)); // NOI18N
        fileSizeTextField.setForeground(new java.awt.Color(0, 0, 204));
        fileSizeTextField.setAutoscrolls(false);
        fileSizeTextField.setEnabled(false);

        opLabel.setText("Output Directory");
        opLabel.setEnabled(false);

        outputDirTextField.setAutoscrolls(false);
        outputDirTextField.setEnabled(false);

        browseOPDirButton.setIcon(new javax.swing.ImageIcon(getClass().getResource("/icons/folder_open_file.png"))); // NOI18N
        browseOPDirButton.setEnabled(false);

        fileSizeLabel.setFont(new java.awt.Font("Verdana", 1, 12)); // NOI18N
        fileSizeLabel.setForeground(new java.awt.Color(0, 0, 204));

        buttonGroup1.add(noOfPartsRadioButton);
        noOfPartsRadioButton.setSelected(true);
        noOfPartsRadioButton.setText("No. of Parts");
        noOfPartsRadioButton.setEnabled(false);

        buttonGroup1.add(maxSizePartRadioButton);
        maxSizePartRadioButton.setText("Maximum Size per Part");
        maxSizePartRadioButton.setEnabled(false);

        buttonGroup1.add(noOfLinesRadioButton);
        noOfLinesRadioButton.setText("No. of Lines per Part");
        noOfLinesRadioButton.setEnabled(false);

        noOfPartsTextField.setAutoscrolls(false);
        noOfPartsTextField.setEnabled(false);

        maxSizePartTextField.setAutoscrolls(false);
        maxSizePartTextField.setEnabled(false);

        noOfLinesTextField.setAutoscrolls(false);
        noOfLinesTextField.setEnabled(false);

        jLabel5.setText("Total Lines");

        totalLinesTextField.setFont(new java.awt.Font("Verdana", 1, 12)); // NOI18N
        totalLinesTextField.setForeground(new java.awt.Color(0, 0, 204));
        totalLinesTextField.setAutoscrolls(false);
        totalLinesTextField.setEnabled(false);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel1)
                            .addComponent(jLabel2))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                                .addComponent(inputFileTextField, javax.swing.GroupLayout.DEFAULT_SIZE, 272, Short.MAX_VALUE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(inputFileButton))
                            .addGroup(layout.createSequentialGroup()
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                    .addComponent(totalLinesTextField, javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(fileSizeTextField, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 131, Short.MAX_VALUE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(fileSizeLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 59, javax.swing.GroupLayout.PREFERRED_SIZE))))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(opLabel)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(noOfLinesRadioButton)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(noOfLinesTextField, javax.swing.GroupLayout.DEFAULT_SIZE, 137, Short.MAX_VALUE))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(maxSizePartRadioButton)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(maxSizePartTextField, javax.swing.GroupLayout.DEFAULT_SIZE, 137, Short.MAX_VALUE))
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(noOfPartsRadioButton)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(noOfPartsTextField, javax.swing.GroupLayout.DEFAULT_SIZE, 137, Short.MAX_VALUE))
                            .addComponent(outputDirTextField, javax.swing.GroupLayout.DEFAULT_SIZE, 272, Short.MAX_VALUE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(browseOPDirButton)))
                .addContainerGap())
            .addComponent(jSeparator1, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 428, Short.MAX_VALUE)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel5)
                .addContainerGap(367, Short.MAX_VALUE))
        );

        layout.linkSize(javax.swing.SwingConstants.HORIZONTAL, new java.awt.Component[] {jLabel1, jLabel2, opLabel});

        layout.linkSize(javax.swing.SwingConstants.HORIZONTAL, new java.awt.Component[] {maxSizePartRadioButton, noOfLinesRadioButton, noOfPartsRadioButton});

        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel1)
                            .addComponent(inputFileTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                .addComponent(jLabel2)
                                .addComponent(fileSizeTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(fileSizeLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 20, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel5)
                            .addComponent(totalLinesTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addComponent(inputFileButton))
                .addGap(26, 26, 26)
                .addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 10, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(opLabel)
                            .addComponent(outputDirTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(noOfPartsRadioButton)
                            .addComponent(noOfPartsTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(maxSizePartRadioButton)
                            .addComponent(maxSizePartTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(noOfLinesRadioButton)
                            .addComponent(noOfLinesTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addComponent(browseOPDirButton))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void inputFileTextFieldActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_inputFileTextFieldActionPerformed
        // TODO add your handling code here:
}//GEN-LAST:event_inputFileTextFieldActionPerformed

    private void inputFileButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_inputFileButtonActionPerformed
        JFileChooser chooser = new JFileChooser(".");
        chooser.setMultiSelectionEnabled(false);

        chooser.setFileSelectionMode(JFileChooser.FILES_ONLY);
        int opt = chooser.showOpenDialog(this);
        if (opt == JFileChooser.APPROVE_OPTION) {
            File f = chooser.getSelectedFile();
            selectedFile = f;
            inputFileTextField.setText(f.getAbsolutePath());
            loadValuesFromFile(f);
        }
    }//GEN-LAST:event_inputFileButtonActionPerformed

    private void loadValuesFromFile(File file){
        Long size = file.length();
        DecimalFormat format = new DecimalFormat("#.##");
        if(size < KB){
            fileSizeLabel.setText("Byte");
            fileSizeTextField.setText(size.toString());
        }else if(size >= KB && size < MB){
            fileSizeLabel.setText("KB");
            Double d = size.doubleValue() / KB.doubleValue();
            fileSizeTextField.setText(format.format(d));
        }else if(size >= MB && size < GB){
            fileSizeLabel.setText("MB");
            Double d = size.doubleValue() / MB.doubleValue();
            fileSizeTextField.setText(format.format(d));
        }else{
            fileSizeLabel.setText("GB");
            Double d = size.doubleValue() / GB.doubleValue();
            fileSizeTextField.setText(format.format(d));
        }
        Long count = countLines(file);
        totalLinesTextField.setText(""+count.toString());
    }

    private Long countLines(File file){
        Long c = 0L;
        BufferedReader br = null;
        try{
            br = new BufferedReader(
                    new FileReader(file));
            while(br.readLine() != null){
                ++c;
            }
            System.gc();
        }catch(Exception e){
            c = 0L;
        }finally{
            if(br != null){
                try {
                    br.close();
                } catch (IOException ex) {
                    Logger.getLogger(NumberOfLineDialog.class.getName()).log(Level.SEVERE, null, ex);
                }
            }
            totalCount = c;
        }
        return c;
    }

    public void readLines(File file, Long start, Long end) throws FileNotFoundException{
        Long c = 1L;
        BufferedReader br = null;
        try{
            br = new BufferedReader(
                    new FileReader(file));
            while(c < start){
                br.readLine();
                ++c;
                System.gc();
            }
            textArea.append("Staring Line Number :\t"+ start.toString() +"\n");
            while(c <= end){
                textArea.append(br.readLine()+"\n");
                ++c;
            }
            textArea.append("\nEnding Line Number :\t"+ end.toString() +"\n");
        }catch(Exception e){
            textArea.setText(e.getMessage());

        }finally{
            if(br != null){
                try {
                    br.close();
                } catch (IOException ex) {
                    Logger.getLogger(NumberOfLineDialog.class.getName()).log(Level.SEVERE, null, ex);
                }
            }
            //System.out.println(textArea.getText());
        }
    }


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton browseOPDirButton;
    private javax.swing.ButtonGroup buttonGroup1;
    private javax.swing.JLabel fileSizeLabel;
    private javax.swing.JTextField fileSizeTextField;
    private javax.swing.JButton inputFileButton;
    private javax.swing.JTextField inputFileTextField;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JRadioButton maxSizePartRadioButton;
    private javax.swing.JTextField maxSizePartTextField;
    private javax.swing.JRadioButton noOfLinesRadioButton;
    private javax.swing.JTextField noOfLinesTextField;
    private javax.swing.JRadioButton noOfPartsRadioButton;
    private javax.swing.JTextField noOfPartsTextField;
    private javax.swing.JLabel opLabel;
    private javax.swing.JTextField outputDirTextField;
    private javax.swing.JTextField totalLinesTextField;
    // End of variables declaration//GEN-END:variables

}
